<!--pages/order-package/order-detail.wxml-->
<view class="container">
  <!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
  <view class="custom-nav-bar">
    <view class="nav-back" bindtap="backToOrderList">
      <van-icon name="arrow-left" size="20px" color="#333"/>
    </view>
    <view class="nav-title">è®¢å•è¯¦æƒ…</view>
    <view class="nav-placeholder"></view>
  </view>

  <!-- åŠ è½½ä¸­çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading"></view>
    <view class="loading-text">è®¢å•ä¿¡æ¯åŠ è½½ä¸­...</view>
  </view>

  <!-- ç©ºæ•°æ®æç¤º -->
  <view class="empty-container" wx:elif="{{!orderInfo}}">
    <view class="empty-icon">ğŸ“‹</view>
    <view class="empty-text">æœªæ‰¾åˆ°è®¢å•ä¿¡æ¯</view>
    <view class="return-btn" bindtap="navigateToOrderList">è¿”å›è®¢å•åˆ—è¡¨</view>
  </view>

  <!-- è®¢å•è¯¦æƒ…å†…å®¹ -->
  <block wx:else>
    <!-- è®¢å•çŠ¶æ€ -->
    <view class="status-card">
      <view class="status-header">
        <text class="status-text">{{orderInfo.statusText}}</text>
        <text class="status-desc">{{orderInfo.statusDesc}}</text>
      </view>
    </view>
    
    <!-- ä¸»ä½“å†…å®¹åŒº -->
    <view class="main-content">
      <!-- è®¢å•è¿›åº¦ -->
      <view class="content-section">
        <view class="section-title">è®¢å•è¿›åº¦</view>
        <view class="section-divider"></view>
        <view class="order-progress">
          <view class="progress-item {{item.status}}" wx:for="{{orderInfo.progress}}" wx:key="title">
            <view class="progress-line" wx:if="{{index > 0}}"></view>
            <view class="progress-circle"></view>
            <view class="progress-content">
              <view class="progress-title">{{item.title}}</view>
              <view class="progress-time" wx:if="{{item.time}}">{{item.time}}</view>
              <view class="progress-desc" wx:if="{{item.desc}}">{{item.desc}}</view>
              <view class="progress-desc" wx:elif="{{item.status == 'waiting' && item.waitDesc}}">{{item.waitDesc}}</view>
              <view class="progress-delivery" wx:if="{{item.delivery}}">{{item.delivery}}</view>
            </view>
          </view>
        </view>
      </view>

      <!-- æ”¶è´§ä¿¡æ¯ -->
      <view class="content-section">
        <view class="section-title">æ”¶è´§ä¿¡æ¯</view>
        <view class="section-divider"></view>
        <view class="recipient-info">
          <view class="recipient-row">
            <text class="recipient-name">{{orderInfo.recipient.name}}</text>
            <text class="recipient-phone">{{orderInfo.recipient.phone}}</text>
          </view>
          <view class="recipient-address">{{orderInfo.recipient.address}}</view>
        </view>
      </view>
      
      <!-- å•†å“ä¿¡æ¯ -->
      <view class="content-section">
        <view class="section-title">å•†å“ä¿¡æ¯</view>
        <view class="section-divider"></view>
        <view class="product-list">
          <view class="product-item" wx:for="{{orderInfo.products}}" wx:key="id">
            <image class="product-image" src="{{item.image}}" mode="aspectFill"></image>
            <view class="product-details">
              <view class="product-name">{{item.name}}</view>
              <view class="product-desc">{{item.desc}}</view>
              <view class="product-price-row">
                <text class="product-price">Â¥{{item.price}}</text>
                <text class="product-quantity">x{{item.quantity}}</text>
              </view>
            </view>
          </view>
        </view>
      </view>
      
      <!-- è®¢å•ä¿¡æ¯ -->
      <view class="content-section">
        <view class="section-title">è®¢å•ä¿¡æ¯</view>
        <view class="section-divider"></view>
        <view class="order-detail-list">
          <view class="detail-item">
            <text class="detail-label">è®¢å•ç¼–å·</text>
            <view class="detail-value-wrap">
              <text class="detail-value">{{orderInfo.orderDetail.orderNumber}}</text>
              <text class="copy-btn" bindtap="copyOrderNumber">å¤åˆ¶</text>
            </view>
          </view>
          <view class="detail-item">
            <text class="detail-label">ä¸‹å•æ—¶é—´</text>
            <text class="detail-value">{{orderInfo.orderDetail.orderTime}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ”¯ä»˜æ–¹å¼</text>
            <text class="detail-value">{{orderInfo.orderDetail.paymentMethod}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">é…é€æ—¶é—´</text>
            <text class="detail-value">{{orderInfo.orderDetail.deliveryTime}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">å¤‡æ³¨</text>
            <text class="detail-value">{{orderInfo.orderDetail.remark}}</text>
          </view>
        </view>
      </view>
      
      <!-- é‡‘é¢ä¿¡æ¯ -->
      <view class="content-section">
        <view class="section-title">æ”¯ä»˜é‡‘é¢</view>
        <view class="section-divider"></view>
        <view class="amount-list">
          <view class="amount-item">
            <text class="amount-label">å•†å“é‡‘é¢</text>
            <text class="amount-value">Â¥{{orderInfo.amount.productTotal}}</text>
          </view>
          <view class="amount-item">
            <text class="amount-label">é…é€è´¹</text>
            <text class="amount-value">Â¥{{orderInfo.amount.deliveryFee}}</text>
          </view>
          <view class="amount-item" wx:if="{{orderInfo.amount.discount > 0}}">
            <text class="amount-label">ä¼˜æƒ </text>
            <text class="amount-value discount-value">-Â¥{{orderInfo.amount.discount}}</text>
          </view>
          <view class="amount-item total">
            <text class="amount-label">å®ä»˜é‡‘é¢</text>
            <text class="amount-value total-value">Â¥{{orderInfo.amount.total}}</text>
          </view>
        </view>
      </view>
    </view>
    
    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="footer-action-bar">
      <!-- æ·»åŠ å¾…ä»˜æ¬¾è®¢å•çš„ç»§ç»­æ”¯ä»˜æŒ‰é’® -->
      <block wx:if="{{orderInfo.status === 'pending'}}">
        <view class="action-button pay-btn" bindtap="continuePay">
          <text class="button-text">ç»§ç»­æ”¯ä»˜</text>
        </view>
      </block>
      <block wx:else>
        <view class="action-button service-btn" bindtap="contactService">
          <text class="button-text">è”ç³»å®¢æœ</text>
        </view>
        <view class="action-button reorder-btn" bindtap="repurchase">
          <text class="button-text">å†æ¥ä¸€å•</text>
        </view>
      </block>
    </view>
  </block>
</view>